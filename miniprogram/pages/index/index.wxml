<!--index.wxml-->
<view class="album-container">
  <view class="fixed-header">
    <view class="header">
      <view class="title">цИСчЪДчЫ╕хЖМ</view>
    </view>
    
    <view class="tabs-container">
      <view class="tab-header-wrapper">
        <scroll-view 
          scroll-x="{{true}}" 
          class="tab-scroll-view" 
          scroll-with-animation="{{true}}" 
          scroll-into-view="{{scrollIntoView}}" 
          enhanced="{{true}}" 
          show-scrollbar="{{false}}" 
          id="tabScrollView"
          bounces="{{false}}"
          scroll-animation-duration="300"
          enable-flex="{{true}}"
        >
          <view class="tab-header">
            <view 
              class="tab-item {{currentTab === index ? 'active' : ''}}" 
              wx:for="{{albumList}}" 
              wx:key="id"
              data-index="{{index}}"
              bindtap="onTabChange"
              bindlongpress="onTabLongPress"
              id="tab-{{index}}"
            >
              <!-- цнгхЬич╝Цш╛СчЪДцаЗчн╛ -->
              <block wx:if="{{isEditingTab && editingTabIndex === index}}">
                <input 
                  class="tab-input" 
                  value="{{editingTabName}}" 
                  focus="{{true}}"
                  bindinput="onTabNameInput"
                  bindconfirm="confirmTabEdit"
                  catchfocus="function(){}"
                  catchblur="confirmTabEdit"
                  maxlength="10"
                  auto-focus
                  adjust-position="{{false}}"
                />
              </block>
              <!-- цЩощАЪцаЗчн╛цШ╛чд║ -->
              <block wx:else>
                {{item.title}}
              </block>
            </view>
          </view>
        </scroll-view>
        
        <!-- цЦ░хвЮцаЗчн╛цМЙщТохЫ║хоЪхЬихП│ф╛з -->
        <view class="add-tab-fixed" bindtap="addNewTab">
          <view class="add-icon">+</view>
        </view>
      </view>
    </view>
    
    <view class="upload-button-container">
      <view class="upload-button" bindtap="uploadImage">
        <view class="upload-icon">+</view>
        <view class="upload-text">ф╕Кф╝ахЫ╛чЙЗ</view>
      </view>
    </view>
  </view>
  
  <view class="scrollable-content">
    <view class="grid-container">
      <!-- цЧ╢щЧ┤ш╜┤х╜вх╝Пх▒Хчд║хЫ╛чЙЗ -->
      <view class="timeline-container">
        <block wx:for="{{groupedImages}}" wx:key="date" wx:for-item="dateGroup">
          <view class="date-group">
            <view class="date-header">
              <view class="date-line"></view>
              <view class="date-text">{{dateGroup.formattedDate}}</view>
              <view class="date-line"></view>
            </view>
            
            <view class="date-images-grid">
              <view 
                class="image-item"
                wx:for="{{dateGroup.images}}" 
                wx:key="id"
                data-id="{{item.id}}" 
              >
                <view class="image-card">
                  <view class="image-wrapper" bindtap="onImageTap" data-id="{{item.id}}">
                    <image 
                      class="album-image"
                      src="{{item.src}}" 
                      mode="aspectFill"
                      lazy-load
                      show-menu-by-longpress
                    />
                  </view>
                  <view class="image-desc-container">
                    <input 
                      class="image-desc" 
                      value="{{item.desc}}" 
                      data-id="{{item.id}}" 
                      bindinput="onDescChange" 
                      bindconfirm="onDescConfirm"
                      placeholder="ц╖╗хКацППш┐░..."
                      maxlength="20"
                    />
                    <view class="edit-icon" catchtap="onEditDesc" data-id="{{item.id}}">тЬО</view>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </block>
      </view>
      
      <view class="empty-state" wx:if="{{groupedImages.length === 0}}">
        <view class="empty-text">цЪВцЧачЫ╕чЙЗ</view>
      </view>

      <view class="loading-container" wx:if="{{isLoading}}">
        <view class="loading-icon"></view>
        <text class="loading-text">хКаш╜╜ф╕н...</text>
      </view>
    </view>
  </view>
  
  <!-- цаЗчн╛цУНф╜ЬшПЬхНХ -->
  <view class="tab-actions-mask" wx:if="{{showTabActions}}" bindtap="closeTabActions">
    <view class="tab-actions" catchtap="function(e){e.stopPropagation();}">
      <view class="action-title">цаЗчн╛цУНф╜Ь</view>
      <view class="action-item" bindtap="startEditTab">
        <view class="action-icon">тЬО</view>
        <view class="action-text">щЗНхС╜хРН</view>
      </view>
      <view class="action-item delete" bindtap="deleteTab">
        <view class="action-icon">ЁЯЧСя╕П</view>
        <view class="action-text">хИащЩд</view>
      </view>
      <view class="action-cancel" bindtap="closeTabActions">хПЦц╢И</view>
    </view>
  </view>
  
  <!-- ч╝Цш╛СцаЗчн╛чЪДчбошодцМЙщТо -->
  <view class="edit-confirm" wx:if="{{isEditingTab}}">
    <view class="confirm-btn" catchtap="confirmTabEdit">чбохоЪ</view>
  </view>

  <!-- ц╖╗хКашЗкхоЪф╣ЙцЦ░х╗║цаЗчн╛х╝╣чкЧ -->
  <view class="custom-modal-mask" wx:if="{{showAddTagModal}}" bindtap="closeAddTagModal">
    <view class="custom-modal" catchtap="function(e){e.stopPropagation();}">
      <view class="custom-modal-title">цЦ░х╗║цаЗчн╛</view>
      <view class="custom-modal-content">
        <input 
          class="custom-modal-input" 
          placeholder="шп╖ш╛УхЕецЦ░цаЗчн╛хРНчз░" 
          value="{{newTagName}}"
          bindinput="onNewTagNameInput"
          focus="{{true}}"
          maxlength="10"
          confirm-type="done"
          bindconfirm="confirmAddTag"
        />
      </view>
      <view class="custom-modal-footer">
        <view class="custom-modal-btn cancel" bindtap="closeAddTagModal">хПЦц╢И</view>
        <view class="custom-modal-btn confirm" bindtap="confirmAddTag">чбохоЪ</view>
      </view>
    </view>
  </view>
</view>